"use strict";(()=>{var e={};e.id=450,e.ids=[450],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},71568:e=>{e.exports=require("zlib")},3263:e=>{e.exports=import("firebase-admin/app")},79637:e=>{e.exports=import("firebase-admin/auth")},72929:e=>{e.exports=import("firebase-admin/firestore")},6005:e=>{e.exports=require("node:crypto")},66429:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>l,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>d});var a=r(49303),n=r(88716),o=r(60670),i=r(35101),c=e([i]);i=(c.then?(await c)():c)[0];let u=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/matches/route",pathname:"/api/matches",filename:"route",bundlePath:"app/api/matches/route"},resolvedPagePath:"/Users/sangeetapapinwar/Developer/pong-rank/app/api/matches/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:h}=u,m="/api/matches/route";function l(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:d})}s()}catch(e){s(e)}})},35101:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{GET:()=>u,POST:()=>p});var a=r(87070),n=r(33133),o=r(61718),i=r(49544),c=r(11500),l=e([n,o]);async function u(){try{if(!(0,i.lF)())return a.NextResponse.json({success:!0,data:{matches:[]}});let e=await (0,i.OZ)();if(0===e.length)return a.NextResponse.json({success:!0,data:{matches:[]}});let t=e.map(e=>e.id),r=await (0,o.FM)(t),s=e.map(e=>{let t=r.get(e.id);return t?(0,o.PF)(t,e):{id:e.id,date:new Date(1e3*e.timestamp).toISOString(),type:"SINGLES",winnerIds:e.winnerIds,loserIds:e.loserIds,score:"?-?",eloChange:e.eloChange}});return s.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),a.NextResponse.json({success:!0,data:{matches:s}})}catch(e){return console.error("Error fetching matches:",e),a.NextResponse.json({success:!1,error:"Failed to fetch matches"},{status:500})}}async function p(e){try{let t=e.headers.get("Authorization");if(!t?.startsWith("Bearer "))return a.NextResponse.json({success:!1,error:"Missing authorization header"},{status:401});let r=t.split("Bearer ")[1];await (0,n.y3)(r);let{type:s,winnerIds:l,loserIds:u,score:p}=await e.json();if(!s||!["SINGLES","DOUBLES"].includes(s))return a.NextResponse.json({success:!1,error:"Invalid match type"},{status:400});if(!Array.isArray(l)||0===l.length)return a.NextResponse.json({success:!1,error:"Winner IDs required"},{status:400});if(!Array.isArray(u)||0===u.length)return a.NextResponse.json({success:!1,error:"Loser IDs required"},{status:400});if(l.length!==u.length)return a.NextResponse.json({success:!1,error:"Team sizes must match"},{status:400});let d="SINGLES"===s?1:2;if(l.length!==d)return a.NextResponse.json({success:!1,error:`${s} requires ${d} player(s) per team`},{status:400});if(!p||"string"!=typeof p)return a.NextResponse.json({success:!1,error:"Score is required"},{status:400});let h=[...l,...u],m=await (0,i.Ue)(h),w=l.map(e=>{let t=m.find(t=>t.id===e);return t?.elo??1200}),g=u.map(e=>{let t=m.find(t=>t.id===e);return t?.elo??1200}),f=(0,c.A2)(w,g),{uuid:y}=(0,i.Ox)();await (0,o.EB)(y,p,s);let{txHash:I}=await (0,i.wV)(y,l,u,f);await (0,o.tF)(y,I);let E={id:y,date:new Date().toISOString(),type:s,winnerIds:l,loserIds:u,score:p,eloChange:f,txHash:I};return a.NextResponse.json({success:!0,data:{match:E,txHash:I}})}catch(e){return console.error("Error logging match:",e),a.NextResponse.json({success:!1,error:"Failed to log match"},{status:500})}}[n,o]=l.then?(await l)():l,s()}catch(e){s(e)}})},49544:(e,t,r)=>{r.d(t,{A2:()=>w,EI:()=>h,OZ:()=>g,Ox:()=>i,Ue:()=>d,lF:()=>c,wV:()=>m}),r(22298),r(58567),r(5161);function s(){throw Error("NEXT_PUBLIC_CONTRACT_ADDRESS environment variable not set")}function a(){throw Error("NEXT_PUBLIC_CONTRACT_ADDRESS environment variable not set")}function n(e){return"0x"+e.replace(/-/g,"").padEnd(64,"0")}function o(e){let t=e.slice(2,34);return`${t.slice(0,8)}-${t.slice(8,12)}-${t.slice(12,16)}-${t.slice(16,20)}-${t.slice(20,32)}`}function i(){let e=crypto.randomUUID();return{uuid:e,bytes32:n(e)}}function c(){return process.env.SEPOLIA_RPC_URL,!1}async function l(e){let t=a(),r=n(e),[s,i,c,l,u,p]=await t.getMatch(r);return p?{id:o(s),winnerIds:i.map(o),loserIds:c.map(o),eloChange:Number(l),timestamp:Number(u),exists:p}:null}async function u(){let e=a();return(await e.getAllPlayerIds()).map(o)}async function p(){let e=a();return(await e.getAllMatchIds()).map(o)}async function d(e){let t=a(),r=e.map(n),[s,i,c,l]=await t.getPlayersBatch(r);return s.map((e,t)=>({id:o(e),elo:Number(i[t]),wins:Number(c[t]),losses:Number(l[t])}))}async function h(e){let t=s(),r=n(e);try{let e=await t.registerPlayer(r);return{txHash:(await e.wait()).hash,success:!0}}catch(e){throw console.error("Error registering player:",e),e}}async function m(e,t,r,a){let o=s(),i=n(e),c=t.map(n),l=r.map(n);try{let e=await o.logMatch(i,c,l,a);return{txHash:(await e.wait()).hash,success:!0}}catch(e){throw console.error("Error logging match:",e),e}}async function w(){let e=await u();return 0===e.length?[]:d(e)}async function g(){let e=await p(),t=[];for(let r of e){let e=await l(r);e&&t.push({id:e.id,winnerIds:e.winnerIds,loserIds:e.loserIds,eloChange:e.eloChange,timestamp:e.timestamp})}return t}},11500:(e,t,r)=>{r.d(t,{A2:()=>s});let s=(e,t)=>{let r=e.reduce((e,t)=>e+t,0)/e.length;return Math.round(32*(1-1/(1+Math.pow(10,(t.reduce((e,t)=>e+t,0)/t.length-r)/400))))}},33133:(e,t,r)=>{r.a(e,async(e,s)=>{try{let c,l,u;r.d(t,{_B:()=>h,y3:()=>m});var a=r(3263),n=r(79637),o=r(72929),i=e([a,n,o]);[a,n,o]=i.then?(await i)():i;let p=()=>{if(0===(0,a.getApps)().length){let e=process.env.FIREBASE_ADMIN_PRIVATE_KEY?.replace(/\\n/g,"\n");if(!e||!process.env.FIREBASE_ADMIN_PROJECT_ID||!process.env.FIREBASE_ADMIN_CLIENT_EMAIL)throw Error("Firebase Admin credentials not configured");c=(0,a.initializeApp)({credential:(0,a.cert)({projectId:process.env.FIREBASE_ADMIN_PROJECT_ID,clientEmail:process.env.FIREBASE_ADMIN_CLIENT_EMAIL,privateKey:e})})}else c=(0,a.getApps)()[0];return l=(0,n.getAuth)(c),u=(0,o.getFirestore)(c),{app:c,adminAuth:l,adminDb:u}},d=()=>(l||p(),l),h=()=>(u||p(),u),m=async e=>{let t=d();try{return await t.verifyIdToken(e)}catch(e){throw console.error("Error verifying ID token:",e),e}};s()}catch(e){s(e)}})},61718:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{EB:()=>l,F6:()=>d,FI:()=>c,FM:()=>p,PF:()=>h,TJ:()=>i,kX:()=>o,tF:()=>u});var a=r(33133),n=e([a]);a=(n.then?(await n)():n)[0];let m="users",w="matches";async function o(e,t,r,s,n){let o=(0,a._B)().collection(m).doc(e);(await o.get()).exists?await o.update({name:r,email:s,photoURL:n}):await o.set({firebaseUid:e,playerId:t,name:r,email:s,photoURL:n,createdAt:new Date})}async function i(e){let t=(0,a._B)().collection(m).doc(e),r=await t.get();return r.exists?r.data():null}async function c(e){let t=(0,a._B)(),r=new Map,s=[];for(let t=0;t<e.length;t+=10)s.push(e.slice(t,t+10));for(let e of s)(await t.collection(m).where("playerId","in",e).get()).docs.forEach(e=>{let t=e.data();r.set(t.playerId,t)});return r}async function l(e,t,r,s){let n=(0,a._B)();await n.collection(w).doc(e).set({matchId:e,score:t,type:r,txHash:s,createdAt:new Date})}async function u(e,t){let r=(0,a._B)();await r.collection(w).doc(e).update({txHash:t})}async function p(e){let t=(0,a._B)(),r=new Map,s=[];for(let t=0;t<e.length;t+=10)s.push(e.slice(t,t+10));for(let e of s)(await t.collection(w).where("matchId","in",e).get()).docs.forEach(e=>{let t=e.data();r.set(t.matchId,t)});return r}function d(e,t){return{id:e.playerId,name:e.name,email:e.email,photoURL:e.photoURL,elo:t.elo,wins:t.wins,losses:t.losses,createdAt:e.createdAt.toDate().toISOString(),firebaseUid:e.firebaseUid}}function h(e,t){return{id:e.matchId,date:new Date(1e3*t.timestamp).toISOString(),type:e.type,winnerIds:t.winnerIds,loserIds:t.loserIds,score:e.score,eloChange:t.eloChange,txHash:e.txHash}}s()}catch(e){s(e)}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,219],()=>r(66429));module.exports=s})();