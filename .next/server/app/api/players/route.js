"use strict";(()=>{var e={};e.id=838,e.ids=[838],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},71568:e=>{e.exports=require("zlib")},3263:e=>{e.exports=import("firebase-admin/app")},79637:e=>{e.exports=import("firebase-admin/auth")},72929:e=>{e.exports=import("firebase-admin/firestore")},6005:e=>{e.exports=require("node:crypto")},83377:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>l,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>d});var s=r(49303),n=r(88716),o=r(60670),i=r(94029),c=e([i]);i=(c.then?(await c)():c)[0];let u=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/players/route",pathname:"/api/players",filename:"route",bundlePath:"app/api/players/route"},resolvedPagePath:"/Users/sangeetapapinwar/Developer/pong-rank/app/api/players/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:h}=u,y="/api/players/route";function l(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:d})}a()}catch(e){a(e)}})},94029:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{GET:()=>l,POST:()=>u});var s=r(87070),n=r(33133),o=r(61718),i=r(49544),c=e([n,o]);async function l(){try{if(!(0,i.lF)())return s.NextResponse.json({success:!0,data:{players:[]}});let e=await (0,i.A2)();if(0===e.length)return s.NextResponse.json({success:!0,data:{players:[]}});let t=e.map(e=>e.id),r=await (0,o.FI)(t),a=e.map(e=>{let t=r.get(e.id);return t?(0,o.F6)(t,e):{id:e.id,name:"Unknown Player",elo:e.elo,wins:e.wins,losses:e.losses,createdAt:new Date().toISOString()}});return a.sort((e,t)=>t.elo-e.elo),s.NextResponse.json({success:!0,data:{players:a}})}catch(e){return console.error("Error fetching players:",e),s.NextResponse.json({success:!1,error:"Failed to fetch players"},{status:500})}}async function u(e){try{let t=e.headers.get("Authorization");if(!t?.startsWith("Bearer "))return s.NextResponse.json({success:!1,error:"Missing authorization header"},{status:401});let r=t.split("Bearer ")[1],a=(await (0,n.y3)(r)).uid,{name:c,email:l,photoURL:u}=await e.json();if(!c||"string"!=typeof c||0===c.trim().length)return s.NextResponse.json({success:!1,error:"Valid name is required"},{status:400});if(await (0,o.TJ)(a))return s.NextResponse.json({success:!1,error:"Player already exists for this user"},{status:409});let{uuid:p}=(0,i.Ox)(),{txHash:d}=await (0,i.EI)(p);await (0,o.kX)(a,p,c.trim(),l||"",u||"");let h={id:p,name:c.trim(),email:l,photoURL:u,elo:1200,wins:0,losses:0,createdAt:new Date().toISOString(),firebaseUid:a};return s.NextResponse.json({success:!0,data:{player:h,txHash:d}})}catch(e){return console.error("Error adding player:",e),s.NextResponse.json({success:!1,error:"Failed to add player"},{status:500})}}[n,o]=c.then?(await c)():c,a()}catch(e){a(e)}})},49544:(e,t,r)=>{r.d(t,{A2:()=>w,EI:()=>h,OZ:()=>m,Ox:()=>i,Ue:()=>d,lF:()=>c,wV:()=>y}),r(22298),r(58567),r(5161);function a(){throw Error("NEXT_PUBLIC_CONTRACT_ADDRESS environment variable not set")}function s(){throw Error("NEXT_PUBLIC_CONTRACT_ADDRESS environment variable not set")}function n(e){return"0x"+e.replace(/-/g,"").padEnd(64,"0")}function o(e){let t=e.slice(2,34);return`${t.slice(0,8)}-${t.slice(8,12)}-${t.slice(12,16)}-${t.slice(16,20)}-${t.slice(20,32)}`}function i(){let e=crypto.randomUUID();return{uuid:e,bytes32:n(e)}}function c(){return process.env.SEPOLIA_RPC_URL,!1}async function l(e){let t=s(),r=n(e),[a,i,c,l,u,p]=await t.getMatch(r);return p?{id:o(a),winnerIds:i.map(o),loserIds:c.map(o),eloChange:Number(l),timestamp:Number(u),exists:p}:null}async function u(){let e=s();return(await e.getAllPlayerIds()).map(o)}async function p(){let e=s();return(await e.getAllMatchIds()).map(o)}async function d(e){let t=s(),r=e.map(n),[a,i,c,l]=await t.getPlayersBatch(r);return a.map((e,t)=>({id:o(e),elo:Number(i[t]),wins:Number(c[t]),losses:Number(l[t])}))}async function h(e){let t=a(),r=n(e);try{let e=await t.registerPlayer(r);return{txHash:(await e.wait()).hash,success:!0}}catch(e){throw console.error("Error registering player:",e),e}}async function y(e,t,r,s){let o=a(),i=n(e),c=t.map(n),l=r.map(n);try{let e=await o.logMatch(i,c,l,s);return{txHash:(await e.wait()).hash,success:!0}}catch(e){throw console.error("Error logging match:",e),e}}async function w(){let e=await u();return 0===e.length?[]:d(e)}async function m(){let e=await p(),t=[];for(let r of e){let e=await l(r);e&&t.push({id:e.id,winnerIds:e.winnerIds,loserIds:e.loserIds,eloChange:e.eloChange,timestamp:e.timestamp})}return t}},33133:(e,t,r)=>{r.a(e,async(e,a)=>{try{let c,l,u;r.d(t,{_B:()=>h,y3:()=>y});var s=r(3263),n=r(79637),o=r(72929),i=e([s,n,o]);[s,n,o]=i.then?(await i)():i;let p=()=>{if(0===(0,s.getApps)().length){let e=process.env.FIREBASE_ADMIN_PRIVATE_KEY?.replace(/\\n/g,"\n");if(!e||!process.env.FIREBASE_ADMIN_PROJECT_ID||!process.env.FIREBASE_ADMIN_CLIENT_EMAIL)throw Error("Firebase Admin credentials not configured");c=(0,s.initializeApp)({credential:(0,s.cert)({projectId:process.env.FIREBASE_ADMIN_PROJECT_ID,clientEmail:process.env.FIREBASE_ADMIN_CLIENT_EMAIL,privateKey:e})})}else c=(0,s.getApps)()[0];return l=(0,n.getAuth)(c),u=(0,o.getFirestore)(c),{app:c,adminAuth:l,adminDb:u}},d=()=>(l||p(),l),h=()=>(u||p(),u),y=async e=>{let t=d();try{return await t.verifyIdToken(e)}catch(e){throw console.error("Error verifying ID token:",e),e}};a()}catch(e){a(e)}})},61718:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{EB:()=>l,F6:()=>d,FI:()=>c,FM:()=>p,PF:()=>h,TJ:()=>i,kX:()=>o,tF:()=>u});var s=r(33133),n=e([s]);s=(n.then?(await n)():n)[0];let y="users",w="matches";async function o(e,t,r,a,n){let o=(0,s._B)().collection(y).doc(e);(await o.get()).exists?await o.update({name:r,email:a,photoURL:n}):await o.set({firebaseUid:e,playerId:t,name:r,email:a,photoURL:n,createdAt:new Date})}async function i(e){let t=(0,s._B)().collection(y).doc(e),r=await t.get();return r.exists?r.data():null}async function c(e){let t=(0,s._B)(),r=new Map,a=[];for(let t=0;t<e.length;t+=10)a.push(e.slice(t,t+10));for(let e of a)(await t.collection(y).where("playerId","in",e).get()).docs.forEach(e=>{let t=e.data();r.set(t.playerId,t)});return r}async function l(e,t,r,a){let n=(0,s._B)();await n.collection(w).doc(e).set({matchId:e,score:t,type:r,txHash:a,createdAt:new Date})}async function u(e,t){let r=(0,s._B)();await r.collection(w).doc(e).update({txHash:t})}async function p(e){let t=(0,s._B)(),r=new Map,a=[];for(let t=0;t<e.length;t+=10)a.push(e.slice(t,t+10));for(let e of a)(await t.collection(w).where("matchId","in",e).get()).docs.forEach(e=>{let t=e.data();r.set(t.matchId,t)});return r}function d(e,t){return{id:e.playerId,name:e.name,email:e.email,photoURL:e.photoURL,elo:t.elo,wins:t.wins,losses:t.losses,createdAt:e.createdAt.toDate().toISOString(),firebaseUid:e.firebaseUid}}function h(e,t){return{id:e.matchId,date:new Date(1e3*t.timestamp).toISOString(),type:e.type,winnerIds:t.winnerIds,loserIds:t.loserIds,score:e.score,eloChange:t.eloChange,txHash:e.txHash}}a()}catch(e){a(e)}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,219],()=>r(83377));module.exports=a})();