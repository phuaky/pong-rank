"use strict";(()=>{var e={};e.id=2,e.ids=[2],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},71568:e=>{e.exports=require("zlib")},3263:e=>{e.exports=import("firebase-admin/app")},79637:e=>{e.exports=import("firebase-admin/auth")},72929:e=>{e.exports=import("firebase-admin/firestore")},6005:e=>{e.exports=require("node:crypto")},86828:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>l,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>d});var n=r(49303),s=r(88716),i=r(60670),o=r(21950),c=e([o]);o=(c.then?(await c)():c)[0];let u=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"/Users/sangeetapapinwar/Developer/pong-rank/app/api/auth/register/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:h}=u,w="/api/auth/register/route";function l(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:d})}a()}catch(e){a(e)}})},21950:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{POST:()=>l});var n=r(87070),s=r(33133),i=r(61718),o=r(49544),c=e([s,i]);async function l(e){try{let t=e.headers.get("Authorization");if(!t?.startsWith("Bearer "))return n.NextResponse.json({success:!1,error:"Missing authorization header"},{status:401});let r=t.split("Bearer ")[1],a=(await (0,s.y3)(r)).uid,{name:c,email:l,photoURL:u}=await e.json();if(!c)return n.NextResponse.json({success:!1,error:"Name is required"},{status:400});let p=await (0,i.TJ)(a);if(p)return await (0,i.kX)(a,p.playerId,c,l||"",u||""),n.NextResponse.json({success:!0,data:{playerId:p.playerId,isNewUser:!1}});let{uuid:d}=(0,o.Ox)(),{txHash:h}=await (0,o.EI)(d);return await (0,i.kX)(a,d,c,l||"",u||""),n.NextResponse.json({success:!0,data:{playerId:d,txHash:h,isNewUser:!0}})}catch(e){return console.error("Error in auth/register:",e),n.NextResponse.json({success:!1,error:"Failed to register user"},{status:500})}}[s,i]=c.then?(await c)():c,a()}catch(e){a(e)}})},49544:(e,t,r)=>{r.d(t,{A2:()=>g,EI:()=>h,OZ:()=>m,Ox:()=>o,Ue:()=>d,lF:()=>c,wV:()=>w}),r(22298),r(58567),r(5161);function a(){throw Error("NEXT_PUBLIC_CONTRACT_ADDRESS environment variable not set")}function n(){throw Error("NEXT_PUBLIC_CONTRACT_ADDRESS environment variable not set")}function s(e){return"0x"+e.replace(/-/g,"").padEnd(64,"0")}function i(e){let t=e.slice(2,34);return`${t.slice(0,8)}-${t.slice(8,12)}-${t.slice(12,16)}-${t.slice(16,20)}-${t.slice(20,32)}`}function o(){let e=crypto.randomUUID();return{uuid:e,bytes32:s(e)}}function c(){return process.env.SEPOLIA_RPC_URL,!1}async function l(e){let t=n(),r=s(e),[a,o,c,l,u,p]=await t.getMatch(r);return p?{id:i(a),winnerIds:o.map(i),loserIds:c.map(i),eloChange:Number(l),timestamp:Number(u),exists:p}:null}async function u(){let e=n();return(await e.getAllPlayerIds()).map(i)}async function p(){let e=n();return(await e.getAllMatchIds()).map(i)}async function d(e){let t=n(),r=e.map(s),[a,o,c,l]=await t.getPlayersBatch(r);return a.map((e,t)=>({id:i(e),elo:Number(o[t]),wins:Number(c[t]),losses:Number(l[t])}))}async function h(e){let t=a(),r=s(e);try{let e=await t.registerPlayer(r);return{txHash:(await e.wait()).hash,success:!0}}catch(e){throw console.error("Error registering player:",e),e}}async function w(e,t,r,n){let i=a(),o=s(e),c=t.map(s),l=r.map(s);try{let e=await i.logMatch(o,c,l,n);return{txHash:(await e.wait()).hash,success:!0}}catch(e){throw console.error("Error logging match:",e),e}}async function g(){let e=await u();return 0===e.length?[]:d(e)}async function m(){let e=await p(),t=[];for(let r of e){let e=await l(r);e&&t.push({id:e.id,winnerIds:e.winnerIds,loserIds:e.loserIds,eloChange:e.eloChange,timestamp:e.timestamp})}return t}},33133:(e,t,r)=>{r.a(e,async(e,a)=>{try{let c,l,u;r.d(t,{_B:()=>h,y3:()=>w});var n=r(3263),s=r(79637),i=r(72929),o=e([n,s,i]);[n,s,i]=o.then?(await o)():o;let p=()=>{if(0===(0,n.getApps)().length){let e=process.env.FIREBASE_ADMIN_PRIVATE_KEY?.replace(/\\n/g,"\n");if(!e||!process.env.FIREBASE_ADMIN_PROJECT_ID||!process.env.FIREBASE_ADMIN_CLIENT_EMAIL)throw Error("Firebase Admin credentials not configured");c=(0,n.initializeApp)({credential:(0,n.cert)({projectId:process.env.FIREBASE_ADMIN_PROJECT_ID,clientEmail:process.env.FIREBASE_ADMIN_CLIENT_EMAIL,privateKey:e})})}else c=(0,n.getApps)()[0];return l=(0,s.getAuth)(c),u=(0,i.getFirestore)(c),{app:c,adminAuth:l,adminDb:u}},d=()=>(l||p(),l),h=()=>(u||p(),u),w=async e=>{let t=d();try{return await t.verifyIdToken(e)}catch(e){throw console.error("Error verifying ID token:",e),e}};a()}catch(e){a(e)}})},61718:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{EB:()=>l,F6:()=>d,FI:()=>c,FM:()=>p,PF:()=>h,TJ:()=>o,kX:()=>i,tF:()=>u});var n=r(33133),s=e([n]);n=(s.then?(await s)():s)[0];let w="users",g="matches";async function i(e,t,r,a,s){let i=(0,n._B)().collection(w).doc(e);(await i.get()).exists?await i.update({name:r,email:a,photoURL:s}):await i.set({firebaseUid:e,playerId:t,name:r,email:a,photoURL:s,createdAt:new Date})}async function o(e){let t=(0,n._B)().collection(w).doc(e),r=await t.get();return r.exists?r.data():null}async function c(e){let t=(0,n._B)(),r=new Map,a=[];for(let t=0;t<e.length;t+=10)a.push(e.slice(t,t+10));for(let e of a)(await t.collection(w).where("playerId","in",e).get()).docs.forEach(e=>{let t=e.data();r.set(t.playerId,t)});return r}async function l(e,t,r,a){let s=(0,n._B)();await s.collection(g).doc(e).set({matchId:e,score:t,type:r,txHash:a,createdAt:new Date})}async function u(e,t){let r=(0,n._B)();await r.collection(g).doc(e).update({txHash:t})}async function p(e){let t=(0,n._B)(),r=new Map,a=[];for(let t=0;t<e.length;t+=10)a.push(e.slice(t,t+10));for(let e of a)(await t.collection(g).where("matchId","in",e).get()).docs.forEach(e=>{let t=e.data();r.set(t.matchId,t)});return r}function d(e,t){return{id:e.playerId,name:e.name,email:e.email,photoURL:e.photoURL,elo:t.elo,wins:t.wins,losses:t.losses,createdAt:e.createdAt.toDate().toISOString(),firebaseUid:e.firebaseUid}}function h(e,t){return{id:e.matchId,date:new Date(1e3*t.timestamp).toISOString(),type:e.type,winnerIds:t.winnerIds,loserIds:t.loserIds,score:e.score,eloChange:t.eloChange,txHash:e.txHash}}a()}catch(e){a(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,219],()=>r(86828));module.exports=a})();